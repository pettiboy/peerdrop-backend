# WebSocket Endpoints Documentation

This document explains how to connect to and use the WebSocket endpoints from frontend applications.

## Available Endpoints

1. `ws://your-server/ws/chat` - Create new chat session
2. `ws://your-server/ws/chat/{code}` - Join existing chat session

## Creating a New Session

To create a new chat session:

```javascript
// Using native WebSocket
const ws = new WebSocket("ws://localhost:8080/ws/chat");

ws.onopen = () => {
  console.log("Connected to server");
};

ws.onmessage = (event) => {
  // First message will contain the session code
  const sessionCode = event.data;
  console.log("Session code:", sessionCode);
};
```

## Joining an Existing Session

To join an existing session using a code:

```javascript
const code = "ABC123"; // The session code received from another user
const ws = new WebSocket(`ws://localhost:8080/ws/chat/${code}`);

ws.onopen = () => {
  console.log("Connected to existing session");
};

ws.onmessage = (event) => {
  // Handle incoming messages
  console.log("Received:", event.data);
};
```

## Message Handling

Both endpoints use the same message format:

```javascript
// Sending messages
ws.send("Hello, other peer!");

// Receiving messages
ws.onmessage = (event) => {
  const message = event.data;
  // Handle different message types
  if (message === "the other guy joined") {
    console.log("Peer connected to session");
  } else {
    console.log("Message from peer:", message);
  }
};
```

## Complete Example

Here's a complete example using a class-based approach:

```javascript
class PeerDropConnection {
  constructor(sessionCode = null) {
    this.baseUrl = "ws://localhost:8080/ws";
    this.sessionCode = sessionCode;
    this.ws = null;
    this.onPeerJoined = null;
    this.onMessage = null;
  }

  connect() {
    const url = this.sessionCode
      ? `${this.baseUrl}/chat/${this.sessionCode}`
      : `${this.baseUrl}/chat`;

    this.ws = new WebSocket(url);

    this.ws.onopen = () => {
      console.log("Connected to PeerDrop");
    };

    this.ws.onmessage = (event) => {
      const message = event.data;

      if (!this.sessionCode) {
        // First message for new sessions contains the code
        this.sessionCode = message;
        console.log("New session created:", this.sessionCode);
      } else if (message === "the other guy joined") {
        // Peer joined notification
        this.onPeerJoined?.();
      } else {
        // Regular message
        this.onMessage?.(message);
      }
    };

    this.ws.onclose = () => {
      console.log("Disconnected from PeerDrop");
    };
  }

  send(message) {
    if (this.ws?.readyState === WebSocket.OPEN) {
      this.ws.send(message);
    }
  }

  close() {
    this.ws?.close();
  }
}
```

### Usage Example

```javascript
// Creating a new session
const newSession = new PeerDropConnection();
newSession.onPeerJoined = () => {
  console.log("Someone joined your session!");
};
newSession.onMessage = (msg) => {
  console.log("Received:", msg);
};
newSession.connect();

// Later, share newSession.sessionCode with peer

// Joining an existing session
const joinSession = new PeerDropConnection("SHARED_CODE");
joinSession.onMessage = (msg) => {
  console.log("Received:", msg);
};
joinSession.connect();
```

## Error Handling

```javascript
ws.onerror = (error) => {
  console.error("WebSocket error:", error);
};

ws.onclose = (event) => {
  if (event.code !== 1000) {
    console.error("Connection lost:", event.reason);
  }
};
```

